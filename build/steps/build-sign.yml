parameters:
  name: ''            # in the form type_platform_host
  displayName: ''     # the human name
  vmImage: ''         # the VM image
  targetFolder: ''    # the bootstrapper target
  dependsOn: []       # the dependiencies
  preBuildSteps: []   # any steps to run before the build
  postBuildSteps: []  # any additional steps to run after the build
  signBuild: false

steps:
  - checkout: none
    clean: true
  
  - task: DownloadBuildArtifacts@0
    displayName: 'Download build artifact win_build'
    inputs:
      artifactName: 'win_build'
      downloadPath: '$(Build.ArtifactsDirectory)'

  - task: securedevelopmentteam.vss-secure-development-tools.build-task-apiscan.APIScan@1
    displayName: 'Run APIScan'
    inputs:
      softwareFolder: '$(Build.ArtifactsDirectory)'
      softwareName: SecureApp
      softwareVersionNum: 5.0.0
      isLargeApp: false
    continueOnError: true

  - template: sign-artifacts/steps/v1.yml@xamarin-templates
    parameters:
      targetFolder: $(Build.ArtifactStagingDirectory)/nuget/signed
      sourceRepo: 'xamarin/xamarin.forms'
      jenkinsEndpoint: Xamarin Code Signing Jenkins
      jenkinsJob: sign-from-vsts
      artifactHost: 'https://dl.internalx.com/vsts-devdiv'

  - task: PublishBuildArtifacts@1
    displayName: 'Publish Artifact: nuget signed'
    inputs:
      PathtoPublish: '$(Build.ArtifactStagingDirectory)/nuget'
      ArtifactName: nuget